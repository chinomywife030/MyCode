# ğŸ“§ Email é‡æ–°å¯„é€å†·å»æ©Ÿåˆ¶æ¸¬è©¦æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

åœ¨ `/auth/check-email` é é¢å¯¦ç¾äº†å®Œæ•´çš„ã€Œé‡æ–°å¯„é€é©—è­‰ä¿¡ã€å†·å»æ©Ÿåˆ¶ï¼š

- âœ… 60 ç§’å†·å»æ™‚é–“ï¼ˆèˆ‡ Supabase SMTP è¨­å®šä¸€è‡´ï¼‰
- âœ… localStorage æŒä¹…åŒ–ï¼ˆåˆ·æ–°é é¢ä»æœ‰æ•ˆï¼‰
- âœ… å€’æ•¸è¨ˆæ™‚é¡¯ç¤ºï¼ˆmm:ss æ ¼å¼ï¼‰
- âœ… é€²åº¦æ¢è¦–è¦ºåŒ–
- âœ… é˜²æ­¢ç‹‚é»ï¼ˆcooldown æœŸé–“ä¸ç™¼ requestï¼‰
- âœ… ä»¥ email å€åˆ†ï¼ˆä¸åŒå¸³è™Ÿä¸äº’ç›¸å½±éŸ¿ï¼‰

---

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆ

### 1. **é…ç½®æ–‡ä»¶**
`bangbuy/lib/config/auth.ts`
```typescript
export const AUTH_CONFIG = {
  RESEND_COOLDOWN_SECONDS: 60,  // å¯èª¿æ•´
  getResendCooldownKey: (email: string) => `bb_resend_email_cooldown_until:${email}`
}
```

### 2. **API Route**
`bangbuy/app/api/auth/resend-confirmation/route.ts`
- POST `/api/auth/resend-confirmation`
- Body: `{ email: string }`
- è™•ç† rate limitã€user not found ç­‰éŒ¯èª¤

### 3. **é é¢æ›´æ–°**
`bangbuy/app/auth/check-email/page.tsx`
- localStorage æŒä¹…åŒ–å†·å»ç‹€æ…‹
- æ¯ 500ms æ›´æ–°å€’æ•¸
- é€²åº¦æ¢é¡¯ç¤º
- æ ¼å¼åŒ–æ™‚é–“é¡¯ç¤º

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1ï¼šåŸºæœ¬å†·å»åŠŸèƒ½

1. **è¨»å†Šæ–°å¸³è™Ÿ**
   ```
   å‰å¾€ /login â†’ è¨»å†Šå¸³è™Ÿ
   è‡ªå‹•å°å‘ /auth/check-email?email=xxx
   ```

2. **é»æ“Šã€Œé‡æ–°å¯„é€é©—è­‰ä¿¡ã€**
   - âœ… æŒ‰éˆ•ç«‹åˆ»è®Šç‚º disabled
   - âœ… é¡¯ç¤ºã€Œå¯æ–¼ 1:00 å¾Œé‡æ–°å¯„é€ã€
   - âœ… å‡ºç¾é€²åº¦æ¢
   - âœ… é¡¯ç¤ºã€Œç‚ºé¿å…æ¿«ç”¨ï¼Œé©—è­‰ä¿¡å¯„é€æœ‰é »ç‡é™åˆ¶ã€

3. **è§€å¯Ÿå€’æ•¸**
   - âœ… æ¯ç§’æ›´æ–°ï¼š1:00 â†’ 0:59 â†’ 0:58 ...
   - âœ… é€²åº¦æ¢é€æ¼¸å¢é•·
   - âœ… å€’æ•¸åˆ° 0 æ™‚æŒ‰éˆ•æ¢å¾©å¯æŒ‰

4. **æª¢æŸ¥ Network**
   - âœ… åªçœ‹åˆ° 1 æ¬¡ POST `/api/auth/resend-confirmation`
   - âœ… cooldown æœŸé–“ç‹‚é»ä¸æœƒç™¼å‡ºæ–° request

---

### æ¸¬è©¦ 2ï¼šlocalStorage æŒä¹…åŒ–

1. **é»æ“Šé‡æ–°å¯„é€**
   - ç­‰å¾…å€’æ•¸é–‹å§‹ï¼ˆä¾‹å¦‚å‰© 50 ç§’ï¼‰

2. **åˆ·æ–°é é¢ï¼ˆF5ï¼‰**
   - âœ… å€’æ•¸ä»å­˜åœ¨
   - âœ… é¡¯ç¤ºæ­£ç¢ºçš„å‰©é¤˜ç§’æ•¸ï¼ˆç´„ 50 ç§’ï¼‰
   - âœ… é€²åº¦æ¢ä½ç½®æ­£ç¢º

3. **é—œé–‰é é¢å†é–‹å•Ÿ**
   - å‰å¾€å…¶ä»–é é¢
   - å†å›åˆ° `/auth/check-email?email=xxx`
   - âœ… å€’æ•¸ä»å­˜åœ¨

4. **æª¢æŸ¥ localStorage**
   ```javascript
   // åœ¨ Console
   const email = 'your-email@example.com';
   const key = `bb_resend_email_cooldown_until:${email}`;
   const until = localStorage.getItem(key);
   console.log('Cooldown until:', new Date(parseInt(until)));
   ```

---

### æ¸¬è©¦ 3ï¼šä¸åŒ Email ä¸äº’ç›¸å½±éŸ¿

1. **å¸³è™Ÿ A è¨»å†Š**
   - Email: `test1@example.com`
   - é»æ“Šé‡æ–°å¯„é€ â†’ é–‹å§‹å€’æ•¸

2. **å¸³è™Ÿ B è¨»å†Š**ï¼ˆé–‹æ–°ç„¡ç—•è¦–çª—ï¼‰
   - Email: `test2@example.com`
   - é»æ“Šé‡æ–°å¯„é€
   - âœ… æ‡‰è©²å¯ä»¥ç«‹åˆ»å¯„é€ï¼ˆä¸å—å¸³è™Ÿ A å½±éŸ¿ï¼‰

3. **æª¢æŸ¥ localStorage**
   ```javascript
   // æ‡‰è©²çœ‹åˆ°å…©å€‹ä¸åŒçš„ key
   bb_resend_email_cooldown_until:test1@example.com
   bb_resend_email_cooldown_until:test2@example.com
   ```

---

### æ¸¬è©¦ 4ï¼šéŒ¯èª¤è™•ç†

1. **Rate Limit éŒ¯èª¤**
   - å¿«é€Ÿé»æ“Šé‡æ–°å¯„é€å¤šæ¬¡ï¼ˆåœ¨ cooldown çµæŸå¾Œï¼‰
   - âœ… æ‡‰è©²é¡¯ç¤ºã€Œå¯„é€é »ç‡éé«˜ï¼Œè«‹ç¨å¾Œå†è©¦ã€

2. **ç¶²è·¯éŒ¯èª¤**
   - é–‹å•Ÿ DevTools â†’ Network â†’ Offline
   - é»æ“Šé‡æ–°å¯„é€
   - âœ… æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
   - âœ… ä¸æ‡‰è©²å•Ÿå‹• cooldownï¼ˆå› ç‚ºå¤±æ•—äº†ï¼‰

3. **ç„¡æ•ˆ Email**
   - æ‰‹å‹•ä¿®æ”¹ URLï¼š`/auth/check-email?email=invalid`
   - é»æ“Šé‡æ–°å¯„é€
   - âœ… æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯

---

### æ¸¬è©¦ 5ï¼šUI/UX

1. **æ™‚é–“æ ¼å¼**
   - 60 ç§’æ™‚ï¼šé¡¯ç¤ºã€Œ1:00ã€
   - 59 ç§’æ™‚ï¼šé¡¯ç¤ºã€Œ0:59ã€
   - 10 ç§’æ™‚ï¼šé¡¯ç¤ºã€Œ0:10ã€
   - 5 ç§’æ™‚ï¼šé¡¯ç¤ºã€Œ5 ç§’ã€
   - âœ… æ ¼å¼æ­£ç¢ºä¸”æ˜“è®€

2. **é€²åº¦æ¢**
   - âœ… å¾å·¦åˆ°å³é€æ¼¸å¢é•·
   - âœ… é¡è‰²ç‚ºè—è‰²ï¼ˆ`bg-blue-500`ï¼‰
   - âœ… å‹•ç•«æµæš¢ï¼ˆ`transition-all duration-500`ï¼‰

3. **æŒ‰éˆ•ç‹€æ…‹**
   - å¯æŒ‰ï¼šç™½è‰²èƒŒæ™¯ + è—è‰²é‚Šæ¡†
   - ç¦ç”¨ï¼šç°è‰² + åŠé€æ˜ï¼ˆ`opacity-50`ï¼‰
   - Loadingï¼šé¡¯ç¤º spinner + "å¯„é€ä¸­..."
   - âœ… ç‹€æ…‹åˆ‡æ›æ¸…æ™°

4. **è¨Šæ¯æç¤º**
   - æˆåŠŸï¼šç¶ è‰²èƒŒæ™¯ + âœ“ åœ–ç¤º
   - éŒ¯èª¤ï¼šç´…è‰²èƒŒæ™¯ + âœ• åœ–ç¤º
   - è³‡è¨Šï¼šè—è‰²èƒŒæ™¯ + â„¹ åœ–ç¤º
   - âœ… é¡è‰²å€åˆ†æ˜ç¢º

---

### æ¸¬è©¦ 6ï¼šé‚Šç•Œæƒ…æ³

1. **cooldown å‰›å¥½çµæŸæ™‚é»æ“Š**
   - ç­‰å¾…å€’æ•¸åˆ° 1 ç§’
   - åœ¨è®Šæˆ 0 çš„ç¬é–“é»æ“Š
   - âœ… æ‡‰è©²å¯ä»¥æ­£å¸¸å¯„é€

2. **å¤šå€‹ tab åŒæ™‚é–‹å•Ÿ**
   - Tab Aï¼šé»æ“Šé‡æ–°å¯„é€
   - Tab Bï¼šåŒæ™‚åˆ·æ–°
   - âœ… å…©å€‹ tab éƒ½æ‡‰è©²é¡¯ç¤ºå€’æ•¸

3. **localStorage è¢«æ¸…é™¤**
   - é»æ“Šé‡æ–°å¯„é€ â†’ é–‹å§‹å€’æ•¸
   - æ‰‹å‹•æ¸…é™¤ localStorage
   - åˆ·æ–°é é¢
   - âœ… å€’æ•¸æ¶ˆå¤±ï¼ŒæŒ‰éˆ•æ¢å¾©å¯æŒ‰

---

## ğŸ“Š é©—æ”¶æ¸…å–®

- [ ] é»æ“Šé‡æ–°å¯„é€å¾Œç«‹åˆ»é–‹å§‹å€’æ•¸
- [ ] å€’æ•¸æ ¼å¼æ­£ç¢ºï¼ˆmm:ss æˆ– xx ç§’ï¼‰
- [ ] é€²åº¦æ¢é¡¯ç¤ºä¸”å‹•ç•«æµæš¢
- [ ] åˆ·æ–°é é¢å€’æ•¸ä»å­˜åœ¨
- [ ] é—œé–‰å†é–‹å•Ÿå€’æ•¸ä»å­˜åœ¨
- [ ] cooldown æœŸé–“ç‹‚é»ä¸æœƒç™¼å‡ºå¤šæ¬¡ request
- [ ] Network tab åªçœ‹åˆ° 1 æ¬¡ POST request
- [ ] ä¸åŒ email ä¸äº’ç›¸å½±éŸ¿
- [ ] å€’æ•¸çµæŸå¾ŒæŒ‰éˆ•æ¢å¾©å¯æŒ‰
- [ ] éŒ¯èª¤æ™‚ä¸å•Ÿå‹• cooldown
- [ ] æˆåŠŸæ™‚é¡¯ç¤º toast è¨Šæ¯
- [ ] é¡¯ç¤ºã€Œç‚ºé¿å…æ¿«ç”¨ã€èªªæ˜æ–‡å­—
- [ ] UI åœ¨æ‰‹æ©Ÿä¸Šé¡¯ç¤ºè‰¯å¥½

---

## ğŸ”§ é…ç½®èª¿æ•´

å¦‚æœéœ€è¦ä¿®æ”¹å†·å»æ™‚é–“ï¼š

```typescript
// bangbuy/lib/config/auth.ts
export const AUTH_CONFIG = {
  RESEND_COOLDOWN_SECONDS: 90,  // æ”¹æˆ 90 ç§’
  // ...
}
```

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q1: å€’æ•¸ä¸æº–ç¢ºï¼Ÿ

**åŸå› ï¼š** ç³»çµ±æ™‚é–“ä¸åŒæ­¥æˆ– localStorage è¢«ä¿®æ”¹

**è§£æ±ºï¼š**
```javascript
// æª¢æŸ¥ localStorage
const key = `bb_resend_email_cooldown_until:${email}`;
const until = localStorage.getItem(key);
console.log('Until:', new Date(parseInt(until)));
console.log('Now:', new Date());

// æ¸…é™¤ä¸¦é‡è©¦
localStorage.removeItem(key);
```

### Q2: åˆ·æ–°å¾Œå€’æ•¸æ¶ˆå¤±ï¼Ÿ

**åŸå› ï¼š** email åƒæ•¸ä¸Ÿå¤±æˆ– localStorage è¢«æ¸…é™¤

**è§£æ±ºï¼š**
```javascript
// æª¢æŸ¥ email
const params = new URLSearchParams(window.location.search);
console.log('Email:', params.get('email'));

// æª¢æŸ¥ localStorage
console.log('Stored email:', localStorage.getItem('bangbuy_signup_email'));
```

### Q3: æŒ‰éˆ•ä¸€ç›´ disabledï¼Ÿ

**åŸå› ï¼š** cooldown æ™‚é–“ç•°å¸¸æˆ– interval æ²’æ¸…é™¤

**è§£æ±ºï¼š**
```javascript
// æ‰‹å‹•æ¸…é™¤ cooldown
const email = 'your-email@example.com';
const key = `bb_resend_email_cooldown_until:${email}`;
localStorage.removeItem(key);
// åˆ·æ–°é é¢
```

---

## ğŸ“± æ‰‹æ©Ÿæ¸¬è©¦

1. **iOS Safari**
   - æ¸¬è©¦å€’æ•¸é¡¯ç¤º
   - æ¸¬è©¦é€²åº¦æ¢å‹•ç•«
   - æ¸¬è©¦æŒ‰éˆ•é»æ“Š

2. **Android Chrome**
   - æ¸¬è©¦ localStorage æŒä¹…åŒ–
   - æ¸¬è©¦åˆ‡æ› app å†å›ä¾†

3. **éŸ¿æ‡‰å¼**
   - æ¸¬è©¦ä¸åŒè¢å¹•å°ºå¯¸
   - ç¢ºä¿æ–‡å­—ä¸æœƒæº¢å‡º
   - ç¢ºä¿æŒ‰éˆ•å¤§å°é©ä¸­

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-16








