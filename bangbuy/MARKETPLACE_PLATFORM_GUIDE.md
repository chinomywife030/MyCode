# ğŸª BangBuy Marketplace å¹³å°è¨­è¨ˆæŒ‡å—

## ğŸ“‹ ç›®éŒ„

1. [æ ¸å¿ƒè¨­è¨ˆåŸå‰‡](#æ ¸å¿ƒè¨­è¨ˆåŸå‰‡)
2. [æ—©æœŸé«”é©—ç³»çµ±](#æ—©æœŸé«”é©—ç³»çµ±)
3. [æœå°‹èˆ‡ç¯©é¸](#æœå°‹èˆ‡ç¯©é¸)
4. [æ–°æ‰‹å¼•å° Coach Mark](#æ–°æ‰‹å¼•å°-coach-mark)
5. [è¨Šæ¯èˆ‡é€šçŸ¥ç³»çµ±](#è¨Šæ¯èˆ‡é€šçŸ¥ç³»çµ±)
6. [è¦–è¦ºé…è‰²è¦å‰‡](#è¦–è¦ºé…è‰²è¦å‰‡)
7. [è³‡æ–™åº«é·ç§»](#è³‡æ–™åº«é·ç§»)

---

## æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

### å¹³å°æ˜¯é›™é‚Šå¸‚å ´

- **è²·å®¶ï¼ˆBuyerï¼‰**ï¼šç™¼ä½ˆéœ€æ±‚ã€ç­‰å¾…å›æ‡‰
- **ä»£è³¼è€… / ç•™å­¸ç”Ÿï¼ˆHelperï¼‰**ï¼šç€è¦½éœ€æ±‚ã€ä¸»å‹•å›æ‡‰

### æ ¸å¿ƒç›®æ¨™

ä¸æ˜¯ DAUï¼Œè€Œæ˜¯ã€ŒæˆåŠŸé…å°ã€ï¼šä½¿ç”¨è€…æ˜¯å¦å®Œæˆä¸€æ¬¡ã€Œç™¼éœ€æ±‚ â†’ è¢«è¯çµ¡ â†’ é–‹å§‹å°è©±ã€

### è¨­è¨ˆå“²å­¸

- **ç©©å®šæ€§** > **æœå°‹æº–ç¢º** > **æˆåŠŸé…å°** > å…¶ä»–åŠŸèƒ½
- ç›®æ¨™æ˜¯è®“ç¬¬ä¸€æ¬¡ä¾†çš„ä½¿ç”¨è€…å¯ä»¥åœ¨ã€Œä¸è¢«æ•™å¤ªå¤šã€çš„æƒ…æ³ä¸‹ï¼Œé †åˆ©å®Œæˆä¸€æ¬¡éœ€æ±‚é…å°

### ç”¢å“æ°£è³ª

BangBuy åœ¨æ­¤éšæ®µçš„æ°£è³ªæ˜¯ï¼š
- ç¤¾ç¾¤å°å‘
- é‚„åœ¨é•·å¤§
- é¡˜æ„è½ä½¿ç”¨è€…èªªè©±
- ä¸æ€¥è‘—è®Šç¾
- ä¸å°ä½¿ç”¨è€…æ–½å£“

---

## æ—©æœŸé«”é©—ç³»çµ±

### ä¸€ã€ç›®å‰éšæ®µå®šç¾©

- å¹³å°è™•æ–¼ã€Œæ—©æœŸé«”é©—æœŸé–“ã€
- ç›®æ¨™ç‚ºå»ºç«‹ä¿¡ä»»èˆ‡æˆåŠŸé…å°
- ä¸ä¸»å‹•æ¨ä»˜è²»ã€ä¸é¡¯ç¤º Premium

### äºŒã€è¨­è¨ˆç›®æ¨™

ä»¥ã€Œé™ä½å•†æ¥­æ„Ÿã€æå‡ä¿¡ä»»æ„Ÿã€é‹ªå¢Šæœªä¾†è¦å‰‡ã€ç‚ºæœ€é«˜è¨­è¨ˆåŸå‰‡ã€‚

æœ¬éšæ®µç›®æ¨™ï¼š
- è®“ä½¿ç”¨è€…ã€Œç†è§£å¹³å°æœ‰è¦å‰‡ã€
- ä½†ä¸ç”¢ç”Ÿè¢«é™åˆ¶ã€è¢«æ”¶è²»çš„å¿ƒç†å£“åŠ›
- ç‚ºæœªä¾†åŠŸèƒ½èª¿æ•´èˆ‡å•†æ¥­æ¨¡å¼é ç•™åˆç†ç©ºé–“

### ä¸‰ã€åŠŸèƒ½ç­–ç•¥

**å†·å•Ÿå‹•èˆ‡æˆé•·æœŸï¼š**
- âœ… **ä¸è¨­ç¡¬æ€§é™åˆ¶**
- âœ… **åƒ…è¨˜éŒ„ä½¿ç”¨è¡Œç‚º**
- âœ… **æ‰€æœ‰æ“ä½œæ°¸é å…è¨±**

**æœªä¾†è¦åŠƒï¼š**
- åƒ…åœ¨å¹³å°è² è¼‰æˆ–æ¿«ç”¨æ˜é¡¯æ™‚ï¼Œæ‰å•Ÿç”¨å¯¦éš›é™åˆ¶
- Premium é ç•™çµ¦ã€Œé«˜é »ã€é‡åº¦ä½¿ç”¨è€…ã€
- ä¸å½±éŸ¿ä¸€èˆ¬ä½¿ç”¨è€…å®ŒæˆåŸºæœ¬æµç¨‹

### å››ã€æœ€çµ‚ç›®æ¨™

- å»ºç«‹å¯è‡ªç„¶è½‰æ›ç‚ºè¨‚é–±çš„ä½¿ç”¨ç¯€å¥
- é”æˆä½å–®åƒ¹ï¼ˆ60 TWDï¼‰é«˜ç•™å­˜çš„è¨‚é–±æ¨¡å‹

### èªè¨€è¦ç¯„

âœ… **å…è¨±ä½¿ç”¨çš„è©å½™**ï¼š
- æ—©æœŸé«”é©—æœŸé–“
- ä½¿ç”¨ç‹€æ³
- ç¤¾ç¾¤å…¬å¹³
- å¹³å°æˆé•·
- è¦å‰‡å°‡é€æ­¥èª¿æ•´
- æ„Ÿè¬ä½ åƒèˆ‡æ—©æœŸé«”é©—

âŒ **åš´ç¦å‡ºç¾**ï¼š
- ~~Premium~~
- ~~ä»˜è²» / æ”¶è²»~~
- ~~å‡ç´š / è§£é–~~
- ~~æ¬¡æ•¸é™åˆ¶~~
- ~~é…é¡~~
- ~~è©¦ç”¨åˆ°æœŸ~~

### æç¤ºå‡ºç¾æ™‚æ©Ÿ

**åƒ…é™ä»¥ä¸‹æƒ…å¢ƒé¡¯ç¤ºæç¤ºï¼š**

1. **é¦–æ¬¡è¯ç¹«ä»–äººæ™‚**
   - é¡¯ç¤ºä¸€æ¬¡æ€§æç¤º
   - å¯é—œé–‰
   - é—œé–‰å¾Œä¸å†é‡è¤‡é¡¯ç¤º

2. **ä½¿ç”¨ç‹€æ³è¼ƒç‚ºæ´»èºæ™‚**
   - ä½¿ç”¨ã€Œæº«å’Œæé†’ã€
   - ä¸é˜»æ–·æ“ä½œ
   - ä¸ä½¿ç”¨ç´…è‰² / è­¦å‘Šæ¨£å¼

3. **çŸ­æ™‚é–“å…§é«˜é »æ“ä½œæ™‚ï¼ˆé˜²æ¿«ç”¨ï¼‰**
   - åƒ…é¡¯ç¤ºã€Œç³»çµ±æé†’ã€
   - ä¸å‡ºç¾ä»»ä½•æ•¸å­—èªªæ˜

### äº”ã€èªæ„éæ¸¡è¨­è¨ˆ

æ ¹æ“šä½¿ç”¨ç‹€æ³èª¿æ•´æ–‡æ¡ˆï¼Œæ‰€æœ‰éæ¸¡åƒ…èª¿æ•´æ–‡æ¡ˆï¼Œ**ä¸å½±éŸ¿åŠŸèƒ½**ï¼š

```
ã€æ¨™æº–æç¤º - åˆæœŸä½¿ç”¨è€…ã€‘
â„¹ï¸ ç›®å‰ç‚º BangBuy æ—©æœŸé«”é©—æœŸé–“ï¼Œ
ç‚ºç¶­æŒç¤¾ç¾¤é‹ä½œå“è³ªï¼Œéƒ¨åˆ†ä½¿ç”¨è¦å‰‡å°‡éš¨å¹³å°æˆé•·é€æ­¥èª¿æ•´ã€‚

ã€åˆæ¬¡äº’å‹•è£œå……ï¼ˆåªé¡¯ç¤ºä¸€æ¬¡ï¼‰ã€‘
æ„Ÿè¬ä½ åƒèˆ‡ BangBuy çš„æ—©æœŸé«”é©—ï¼Œ
ä½ çš„ä½¿ç”¨å›é¥‹å°‡ç›´æ¥å½±éŸ¿å¹³å°æœªä¾†çš„è¨­è¨ˆæ–¹å‘ã€‚

ã€é«˜é »ä½¿ç”¨è€…æº«å’Œæé†’ã€‘
å¹³å°æˆé•·ä¸­ï¼Œç‚ºç¶­æŒç¤¾ç¾¤å…¬å¹³ï¼Œä½¿ç”¨è¦å‰‡æ­£åœ¨å„ªåŒ–ã€‚
æ„Ÿè¬ä½ çš„æ´»èºåƒèˆ‡ï¼
```

### ä½¿ç”¨æ–¹å¼

```typescript
import { useEarlyAccess } from '@/hooks/useEarlyAccess';

function MyComponent() {
  const { state, checkContactStatus, recordContact, getNoticeMessage } = useEarlyAccess();
  
  const handleStartChat = async (targetUserId: string) => {
    // æª¢æŸ¥è¯ç¹«ç‹€æ…‹ï¼ˆä¸é˜»æ–·ï¼‰
    const result = await checkContactStatus(targetUserId);
    
    // é¡¯ç¤ºæº«å’Œæç¤ºï¼ˆä¸é˜»æ–·æ“ä½œï¼‰
    if (result.showNotice) {
      showNotice(getNoticeMessage(result.showNotice));
    }
    
    // è¨˜éŒ„å·²ç™¼èµ·è¯ç¹«
    await recordContact(targetUserId);
    
    // è·³è½‰åˆ°èŠå¤©
    router.push(`/chat?target=${targetUserId}`);
  };
}
```

### UI è¦ç¯„

**æ¨è–¦æ¨£å¼**ï¼š
- Info Banner / Toast é¡å‹
- é¡è‰²ï¼šæ·ºè— / ä¸­æ€§ç°
- å­—ç´šï¼šå°æ–¼ä¸»å…§å®¹
- å¯æ‰‹å‹•é—œé–‰
- ä¸å½±éŸ¿é»æ“Šæµç¨‹

**ç¦æ­¢æ¨£å¼**ï¼š
- âŒ Modal æ“‹å…¨ç•«é¢
- âŒ å€’æ•¸è¨ˆæ™‚
- âŒ å¼·åˆ¶ç¢ºèªå½ˆçª—
- âŒ ä»»ä½•ã€Œä½ ä¸èƒ½å†ç”¨äº†ã€è¦–è¦º

### ç‹€æ…‹ç®¡ç†ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰

```typescript
// é€™äº›ç‹€æ…‹åƒ…ç”¨æ–¼æ§åˆ¶æç¤ºé¡¯ç¤ºé »ç‡ï¼Œä¸å°ä½¿ç”¨è€…æ›å…‰
interface EarlyAccessState {
  isEarlyAccessUser: boolean;      // æ˜¯å¦ç‚ºæ—©æœŸé«”é©—ç”¨æˆ¶
  hasSeenNotice: boolean;          // æ˜¯å¦å·²çœ‹éæ—©æœŸé«”é©—æç¤º
  usageLevel: 'normal' | 'active' | 'very_active';  // ä½¿ç”¨ç‹€æ³
}
```

### æ›å…‰æ’åºçµæ§‹ï¼ˆä¿ç•™æœªä¾†å¯ç”¨ï¼‰

```sql
-- wish_requests å’Œ trips éƒ½æœ‰é€™å…©å€‹æ¬„ä½ï¼ˆUI ä¸é¡¯ç¤ºï¼‰
ALTER TABLE wish_requests ADD COLUMN priority INTEGER DEFAULT 0;
ALTER TABLE wish_requests ADD COLUMN score NUMERIC(10,2) DEFAULT 0;

-- æŸ¥è©¢æ™‚æœƒå„ªå…ˆæ’åº
ORDER BY priority DESC, created_at DESC
```

---

## æœå°‹èˆ‡ç¯©é¸

### çœŸå¯¦å¾Œç«¯æœå°‹

æ‰€æœ‰æœå°‹éƒ½æ˜¯ server-sideï¼Œä¸æ˜¯å‰ç«¯å‡ filterï¼š

```typescript
// é—œéµå­—æœå°‹
q = q.or(`title.ilike.%${search}%,description.ilike.%${search}%`);

// åœ‹å®¶ç¯©é¸
q = q.eq('target_country', country);

// æ—¥æœŸç¯©é¸
q = q.gte('date', dateFrom);
q = q.lte('date', dateTo);
```

### ç¯©é¸æ¬„ä½

- **é—œéµå­—**ï¼šæœå°‹æ¨™é¡Œå’Œæè¿°
- **åœ‹å®¶/åœ°å€**ï¼š40+ åœ‹å®¶é¸é …
- **æ—¥æœŸç¯„åœ**ï¼šè¡Œç¨‹æ—¥æœŸæˆ–æˆªæ­¢æ—¥æœŸ
- **æ’åº**ï¼šæœ€æ–°ç™¼å¸ƒã€åƒ¹æ ¼ä½åˆ°é«˜ã€åƒ¹æ ¼é«˜åˆ°ä½

### åŸå‰‡

- åªä¿ç•™ã€Œæœƒå½±éŸ¿æ±ºç­–ã€çš„æ¬„ä½
- å¦‚æœåŠŸèƒ½æ²’æœ‰ä½œç”¨ï¼Œå¯§é¡˜æ‹¿æ‰ UI

---

## æ–°æ‰‹å¼•å° Coach Mark

### ä¸‰æ­¥é©Ÿå¼•å°

1. **åˆ‡æ›èº«åˆ†**ï¼šé»é€™è£¡åˆ‡æ›ä½ çš„èº«åˆ†ï¼ˆè²·å®¶/ä»£è³¼è€…ï¼‰
2. **ç™¼ä½ˆå…§å®¹**ï¼šé»é€™è£¡ç™¼ä½ˆä½ çš„éœ€æ±‚æˆ–è¡Œç¨‹
3. **é–‹å§‹å°è©±**ï¼šæœ‰äººå›æ‡‰å¾Œï¼Œé»é€™è£¡é–‹å§‹å°è©±

### è¨­è¨ˆåŸå‰‡

- åŠé€æ˜é®ç½© + æŒ–æ´æ•ˆæœ
- ç®­é ­æº–ç¢ºæŒ‡å‘å¯é»æ“Šå…ƒç´ 
- æ¡Œæ©Ÿèˆ‡æ‰‹æ©Ÿåˆ†é–‹åˆ¤æ–·ä½ç½®
- ä¸€æ­¥åªæ•™ä¸€ä»¶äº‹
- å¯é»æ“Šã€å¯è·³éï¼Œä¸é–æ­»ç•«é¢

### ä½¿ç”¨æ–¹å¼

```tsx
// åœ¨é¦–é å¼•å…¥
import InteractiveOnboarding from '@/components/InteractiveOnboarding';

// åœ¨ JSX ä¸­
<InteractiveOnboarding />
```

### localStorage Key

```
bangbuy_coach_mark_v2
```

---

## è¨Šæ¯èˆ‡é€šçŸ¥ç³»çµ±

### é€šçŸ¥ç´…é»é‚è¼¯

- é»é€²å–®ä¸€é€šçŸ¥ â†’ æ¸›å°‘ç´…é»æ•¸é‡ï¼ˆåŒæ™‚æ›´æ–° `is_read` å’Œ `read_at`ï¼‰
- é»ã€Œå…¨éƒ¨å·²è®€ã€â†’ æ¸…ç©ºç´…é»
- ç‹€æ…‹å¯«å…¥è³‡æ–™åº«ï¼Œä¸åªåœ¨å‰ç«¯

### RPC å‡½æ•¸

```typescript
// æ¨™è¨˜å–®ç­†å·²è®€
await supabase.rpc('mark_notification_read', { p_id: notificationId });
// è¿”å› { updated: boolean, unread_count: number }

// æ¨™è¨˜å…¨éƒ¨å·²è®€
await supabase.rpc('mark_all_notifications_read');
// è¿”å› 0

// ç²å–æœªè®€æ•¸
await supabase.rpc('get_unread_notification_count');
```

### Session è‡ªå‹•åˆ·æ–°

```typescript
// supabase.ts è¨­å®š
autoRefreshToken: true,
flowType: 'pkce',

// visibilitychange ç›£è½
// é é¢é‡æ–°æ¿€æ´»æ™‚æª¢æŸ¥ tokenï¼Œå¿«éæœŸå‰‡è‡ªå‹•åˆ·æ–°
```

### safeCall éŒ¯èª¤è™•ç†

- è‡ªå‹•è™•ç† JWT éæœŸ
- é‡åˆ° auth éŒ¯èª¤æ™‚å˜—è©¦åˆ·æ–° session
- åˆ·æ–°å¤±æ•—å‰‡ç™»å‡º
- ç¶²è·¯éŒ¯èª¤è‡ªå‹•é‡è©¦

---

## è¦–è¦ºé…è‰²è¦å‰‡

### è§’è‰²é¡è‰²

| è§’è‰² | é¡è‰² | ç”¨é€” |
|------|------|------|
| è²·å®¶ï¼ˆBuyerï¼‰ | è—è‰² `blue-500/600` | ç™¼å¸ƒéœ€æ±‚ã€è¯ç¹«ä»£è³¼ |
| ä»£è³¼è€…ï¼ˆShopperï¼‰ | æ©˜è‰² `orange-500/600` | ç™¼å¸ƒè¡Œç¨‹ã€æ¥å–®ç§è¨Š |

### è¦å‰‡

- é¡è‰²åªç”¨æ–¼ã€Œèº«åˆ†èˆ‡è¡Œç‚ºã€
- Header / éè¡Œç‚ºå€åŸŸä¿æŒä¸­æ€§ï¼ˆç°è‰²ï¼‰
- ä¸è¦åŒæ™‚å‡ºç¾å…©å€‹ä¸»è‰² CTA
- é€šçŸ¥ç´…é»æ°¸é æ˜¯ç´…è‰²

### ç¯„ä¾‹

```tsx
// ModeToggle è† å›Š
className={mode === 'requester'
  ? 'bg-blue-50 text-blue-600'
  : 'bg-orange-50 text-orange-600'
}

// CTA æŒ‰éˆ•
className={mode === 'requester'
  ? 'bg-blue-500 hover:bg-blue-600'
  : 'bg-orange-500 hover:bg-orange-600'
}
```

---

## è³‡æ–™åº«é·ç§»

### éœ€è¦åŸ·è¡Œçš„ SQL æª”æ¡ˆ

1. **`migration-marketplace-platform.sql`** - æ—©æœŸé«”é©—ç³»çµ±
   - å‰µå»º `daily_message_quotas` è¡¨ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰
   - æ·»åŠ  `priority` å’Œ `score` æ¬„ä½
   - å‰µå»ºç›¸é—œ RPC å‡½æ•¸

2. **`migration-notification-read-fix.sql`** - ä¿®å¾©é€šçŸ¥å·²è®€
   - ä¿®å¾© `mark_notification_read` è¿”å› unread_count
   - åŒæ­¥ `is_read` å’Œ `read_at` æ¬„ä½

### åŸ·è¡Œé †åº

```bash
# åœ¨ Supabase SQL Editor ä¸­ä¾åºåŸ·è¡Œ
1. migration-marketplace-platform.sql
2. migration-notification-read-fix.sql
```

---

## ä¸è¦åšçš„äº‹

âŒ ä»˜è²»é   
âŒ èŠ±ä¿å¾½ç«   
âŒ ç„¡å¯¦éš›ä½œç”¨çš„åŠŸèƒ½æŒ‰éˆ•  
âŒ æ²’æ¥å¾Œç«¯çš„ UI  
âŒ èŠ±ä¿ onboarding  
âŒ è¤‡é›œé€²éš filter  
âŒ ä»»ä½•æ•¸å­—é™åˆ¶èªªæ˜  
âŒ è­¦å‘Šæˆ–é˜»æ–·å¼å½ˆçª—  

---

## è¯çµ¡æ–¹å¼

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ Console éŒ¯èª¤è¨Šæ¯ï¼Œæˆ–æŸ¥é–±å…¶ä»–ç›¸é—œæ–‡ä»¶ï¼š
- `STABILIZATION_GUIDE.md`
- `NOTIFICATION_SYSTEM_README.md`
- `CHAT_SYSTEM_REPORT.md`
